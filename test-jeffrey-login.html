<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeffreyç™»å…¥æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
        }
        .test-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #007bff;
            background-color: #f8f9fa;
        }
        .success {
            border-left-color: #28a745;
            background-color: #d4edda;
        }
        .error {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
        .warning {
            border-left-color: #ffc107;
            background-color: #fff3cd;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
            font-size: 14px;
            width: 200px;
        }
        .message-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Jeffreyç™»å…¥èˆ‡ç•™è¨€æ¸¬è©¦</h1>
        
        <div class="message-info">
            <h3>ğŸ“‹ ç™¼ç¾çš„å•é¡Œ</h3>
            <p>æ ¹æ“šæ•¸æ“šåº«åˆ†æï¼Œç™¼ç¾ä»¥ä¸‹æƒ…æ³ï¼š</p>
            <ul>
                <li>âœ… Jeffreyç”¨æˆ¶ç¢ºå¯¦å­˜åœ¨ (user-2)</li>
                <li>âœ… æœ‰å¤šæ¢çµ¦Jeffreyçš„ç•™è¨€è¨˜éŒ„</li>
                <li>âš ï¸ æœ€æ–°ç•™è¨€ï¼š"å‰‹æ˜Ÿ" (æœªè®€ç‹€æ…‹)</li>
                <li>âŒ å‰ç«¯å¿«é€Ÿç™»å…¥å¯èƒ½ä½¿ç”¨èˆŠæ†‘è­‰</li>
            </ul>
        </div>

        <div class="step">
            <h3>æ­¥é©Ÿ 1: æ¸¬è©¦Jeffreyç™»å…¥</h3>
            <p>å˜—è©¦ä¸åŒçš„ç™»å…¥æ–¹å¼ï¼š</p>
            
            <div style="margin: 10px 0;">
                <h4>æ–¹æ³• 1: ä½¿ç”¨ç”¨æˆ¶å "Jeffrey"</h4>
                <input type="text" id="username1" value="Jeffrey" placeholder="ç”¨æˆ¶å">
                <input type="password" id="password1" value="pm123" placeholder="å¯†ç¢¼">
                <button onclick="testLogin(1)">æ¸¬è©¦ç™»å…¥</button>
            </div>
            
            <div style="margin: 10px 0;">
                <h4>æ–¹æ³• 2: ä½¿ç”¨åŸå§‹ç”¨æˆ¶å "pm001"</h4>
                <input type="text" id="username2" value="pm001" placeholder="ç”¨æˆ¶å">
                <input type="password" id="password2" value="pm123" placeholder="å¯†ç¢¼">
                <button onclick="testLogin(2)">æ¸¬è©¦ç™»å…¥</button>
            </div>
            
            <div style="margin: 10px 0;">
                <h4>æ–¹æ³• 3: å˜—è©¦é»˜èªå¯†ç¢¼</h4>
                <input type="text" id="username3" value="Jeffrey" placeholder="ç”¨æˆ¶å">
                <input type="password" id="password3" value="default123" placeholder="å¯†ç¢¼">
                <button onclick="testLogin(3)">æ¸¬è©¦ç™»å…¥</button>
            </div>
            
            <div id="loginResult"></div>
        </div>

        <div class="step">
            <h3>æ­¥é©Ÿ 2: æª¢æŸ¥Jeffreyçš„æœªè®€ç•™è¨€</h3>
            <button onclick="checkJeffreyMessages()">æª¢æŸ¥Jeffreyçš„ç•™è¨€</button>
            <div id="messagesResult"></div>
        </div>

        <div class="step">
            <h3>æ­¥é©Ÿ 3: æ¸¬è©¦å‰ç«¯ç•™è¨€çµ„ä»¶</h3>
            <p>å¦‚æœç™»å…¥æˆåŠŸï¼Œæ¸¬è©¦å‰ç«¯ç•™è¨€å°å·¥å…·ï¼š</p>
            <button onclick="openSystemAsJeffrey()">æ‰“é–‹ç³»çµ±ä¸¦ç™»å…¥Jeffrey</button>
            <div class="warning">
                <h4>âš ï¸ æ³¨æ„äº‹é …</h4>
                <ul>
                    <li>Jeffreyçš„å¯†ç¢¼å¯èƒ½å·²ç¶“è¢«ä¿®æ”¹</li>
                    <li>éœ€è¦ä½¿ç”¨æ­£ç¢ºçš„ç”¨æˆ¶åå’Œå¯†ç¢¼çµ„åˆ</li>
                    <li>å‰ç«¯å¿«é€Ÿç™»å…¥å¯èƒ½éœ€è¦æ›´æ–°</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h3>æ­¥é©Ÿ 4: æ‰‹å‹•ç™»å…¥æŒ‡å—</h3>
            <div class="message-info">
                <h4>å¦‚æœè‡ªå‹•ç™»å…¥å¤±æ•—ï¼Œè«‹æ‰‹å‹•ç™»å…¥ï¼š</h4>
                <ol>
                    <li>æ‰“é–‹ç³»çµ±ï¼š<button onclick="openSystem()">http://localhost:5173</button></li>
                    <li>åœ¨ç™»å…¥è¡¨å–®ä¸­è¼¸å…¥ï¼š
                        <ul>
                            <li>ç”¨æˆ¶åï¼š<code>Jeffrey</code></li>
                            <li>å¯†ç¢¼ï¼šå˜—è©¦ <code>pm123</code> æˆ– <code>default123</code></li>
                        </ul>
                    </li>
                    <li>ç™»å…¥å¾Œæª¢æŸ¥å³ä¸Šè§’æ˜¯å¦æœ‰ç•™è¨€å°å·¥å…·</li>
                </ol>
            </div>
        </div>

        <div class="step">
            <h3>æ­¥é©Ÿ 5: èª¿è©¦ä¿¡æ¯</h3>
            <button onclick="showDebugInfo()">é¡¯ç¤ºèª¿è©¦ä¿¡æ¯</button>
            <div id="debugInfo"></div>
        </div>
    </div>

    <script>
        let jeffreyToken = '';

        async function testLogin(method) {
            const username = document.getElementById(`username${method}`).value;
            const password = document.getElementById(`password${method}`).value;
            
            try {
                const response = await fetch('http://localhost:3004/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const result = await response.json();
                
                if (result.success) {
                    jeffreyToken = result.data.token;
                    document.getElementById('loginResult').innerHTML = 
                        `<div class="step success">âœ… æ–¹æ³• ${method} ç™»å…¥æˆåŠŸï¼<br>
                        ç”¨æˆ¶åï¼š${username}<br>
                        å¯¦éš›ç”¨æˆ¶ï¼š${result.data.user.username}<br>
                        <pre>${JSON.stringify(result.data.user, null, 2)}</pre></div>`;
                } else {
                    document.getElementById('loginResult').innerHTML = 
                        `<div class="step error">âŒ æ–¹æ³• ${method} ç™»å…¥å¤±æ•—ï¼š${result.message}</div>`;
                }
            } catch (error) {
                document.getElementById('loginResult').innerHTML = 
                    `<div class="step error">âŒ æ–¹æ³• ${method} è«‹æ±‚å¤±æ•—ï¼š${error.message}</div>`;
            }
        }

        async function checkJeffreyMessages() {
            if (!jeffreyToken) {
                alert('è«‹å…ˆæˆåŠŸç™»å…¥Jeffrey');
                return;
            }

            try {
                const response = await fetch('http://localhost:3004/api/messages/unread', {
                    headers: { 'Authorization': `Bearer ${jeffreyToken}` }
                });

                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('messagesResult').innerHTML = 
                        `<div class="step success">âœ… Jeffreyçš„æœªè®€ç•™è¨€ (${result.data.length} æ¢)ï¼š
                        <pre>${JSON.stringify(result.data, null, 2)}</pre></div>`;
                } else {
                    document.getElementById('messagesResult').innerHTML = 
                        `<div class="step error">âŒ ç²å–ç•™è¨€å¤±æ•—ï¼š${result.message}</div>`;
                }
            } catch (error) {
                document.getElementById('messagesResult').innerHTML = 
                    `<div class="step error">âŒ è«‹æ±‚å¤±æ•—ï¼š${error.message}</div>`;
            }
        }

        function openSystemAsJeffrey() {
            if (!jeffreyToken) {
                alert('è«‹å…ˆæˆåŠŸç™»å…¥Jeffrey');
                return;
            }
            
            // å°‡tokenå­˜å„²åˆ°localStorageï¼Œç„¶å¾Œæ‰“é–‹ç³»çµ±
            localStorage.setItem('authToken', jeffreyToken);
            localStorage.setItem('userRole', 'PM');
            localStorage.setItem('username', 'Jeffrey');
            
            window.open('http://localhost:5173', '_blank');
        }

        function openSystem() {
            window.open('http://localhost:5173', '_blank');
        }

        function showDebugInfo() {
            const debugInfo = `
æ•¸æ“šåº«ä¸­çš„Jeffreyä¿¡æ¯ï¼š
- ID: user-2
- ç”¨æˆ¶å: Jeffrey
- éƒµç®±: pm001@yunshui.com
- è§’è‰²: PM
- å¯†ç¢¼å“ˆå¸Œ: $2b$12$zqKXuncEKJJ/4hsMpBOtbe1VJhDuDoy1Zc2XE.WUZlxKtdy1UHjT2

æœªè®€ç•™è¨€ï¼š
- id-2070: "è€¶æ ¼å‰‹æ˜Ÿ" (æœªè®€)
- id-2071: "å‰‹æ˜Ÿ" (æœªè®€)

å¯èƒ½çš„å•é¡Œï¼š
1. å¯†ç¢¼å·²è¢«ä¿®æ”¹ï¼Œä¸å†æ˜¯ pm123
2. å‰ç«¯å¿«é€Ÿç™»å…¥ä½¿ç”¨èˆŠæ†‘è­‰
3. ç•™è¨€çµ„ä»¶å¯èƒ½æœ‰ç·©å­˜å•é¡Œ
            `;
            
            document.getElementById('debugInfo').innerHTML = 
                `<div class="step warning"><pre>${debugInfo}</pre></div>`;
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•å˜—è©¦ç¬¬ä¸€ç¨®æ–¹æ³•
        window.onload = function() {
            setTimeout(() => testLogin(1), 1000);
        };
    </script>
</body>
</html>