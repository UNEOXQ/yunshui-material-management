<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIèª¿è©¦é é¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f8ff;
        }
        .debug-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h2>ğŸ”§ APIé€£æ¥èª¿è©¦</h2>
        
        <div id="env-info" class="test-result info">
            æª¢æ¸¬ç’°å¢ƒè®Šæ•¸...
        </div>
        
        <button onclick="testEnvironment()">æª¢æ¸¬ç’°å¢ƒé…ç½®</button>
        <button onclick="testDirectAPI()">æ¸¬è©¦ç›´æ¥APIé€£æ¥</button>
        <button onclick="testViteAPI()">æ¸¬è©¦Viteç’°å¢ƒè®Šæ•¸API</button>
        <button onclick="testLogin()">æ¸¬è©¦ç™»å…¥API</button>
        
        <div id="results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `<div class="test-result ${type}">[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }
        
        function testEnvironment() {
            log('=== ç’°å¢ƒè®Šæ•¸æª¢æ¸¬ ===', 'info');
            
            // æª¢æ¸¬ç•¶å‰é é¢URL
            log(`ç•¶å‰é é¢URL: ${window.location.href}`, 'info');
            
            // æª¢æ¸¬å¯èƒ½çš„API URL
            const possibleUrls = [
                'http://localhost:3004/api',
                'http://192.168.68.99:3004/api',
                '/api'
            ];
            
            possibleUrls.forEach(url => {
                log(`å¯èƒ½çš„API URL: ${url}`, 'info');
            });
        }
        
        async function testDirectAPI() {
            log('=== æ¸¬è©¦ç›´æ¥APIé€£æ¥ ===', 'info');
            
            const testUrls = [
                'http://192.168.68.99:3004/health',
                'http://localhost:3004/health'
            ];
            
            for (const url of testUrls) {
                try {
                    log(`æ¸¬è©¦: ${url}`, 'info');
                    const response = await fetch(url);
                    const data = await response.json();
                    log(`âœ… ${url} - æˆåŠŸ: ${JSON.stringify(data)}`, 'success');
                } catch (error) {
                    log(`âŒ ${url} - å¤±æ•—: ${error.message}`, 'error');
                }
            }
        }
        
        async function testViteAPI() {
            log('=== æ¸¬è©¦Viteç’°å¢ƒè®Šæ•¸ ===', 'info');
            
            // æ¨¡æ“¬Viteç’°å¢ƒè®Šæ•¸è®€å–
            const viteApiUrl = 'http://192.168.68.99:3004/api'; // é€™æ‡‰è©²æ˜¯ç’°å¢ƒè®Šæ•¸çš„å€¼
            log(`æ¨¡æ“¬VITE_API_URL: ${viteApiUrl}`, 'info');
            
            try {
                const healthUrl = viteApiUrl.replace('/api', '/health');
                log(`æ¸¬è©¦å¥åº·æª¢æŸ¥: ${healthUrl}`, 'info');
                const response = await fetch(healthUrl);
                const data = await response.json();
                log(`âœ… Vite APIå¥åº·æª¢æŸ¥æˆåŠŸ: ${JSON.stringify(data)}`, 'success');
            } catch (error) {
                log(`âŒ Vite APIå¥åº·æª¢æŸ¥å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        async function testLogin() {
            log('=== æ¸¬è©¦ç™»å…¥API ===', 'info');
            
            const apiUrl = 'http://192.168.68.99:3004/api';
            const loginData = {
                username: 'admin',
                password: 'admin123'
            };
            
            try {
                log(`ç™»å…¥URL: ${apiUrl}/auth/login`, 'info');
                log(`ç™»å…¥è³‡æ–™: ${JSON.stringify(loginData)}`, 'info');
                
                const response = await fetch(`${apiUrl}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(loginData)
                });
                
                log(`éŸ¿æ‡‰ç‹€æ…‹: ${response.status} ${response.statusText}`, 'info');
                
                const result = await response.json();
                log(`éŸ¿æ‡‰å…§å®¹: ${JSON.stringify(result, null, 2)}`, response.ok ? 'success' : 'error');
                
                if (result.success && result.data && result.data.user) {
                    log(`âœ… ç™»å…¥æˆåŠŸ: ${result.data.user.username} (${result.data.user.role})`, 'success');
                } else {
                    log(`âŒ ç™»å…¥å¤±æ•—: ${result.message || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                }
            } catch (error) {
                log(`âŒ ç™»å…¥è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
                log(`éŒ¯èª¤è©³æƒ…: ${JSON.stringify({
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                }, null, 2)}`, 'error');
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æ¸¬ç’°å¢ƒ
        window.onload = function() {
            document.getElementById('env-info').innerHTML = `
                <strong>ç’°å¢ƒè³‡è¨Š:</strong><br>
                é é¢URL: ${window.location.href}<br>
                User Agent: ${navigator.userAgent}<br>
                æ™‚é–“: ${new Date().toLocaleString()}
            `;
            
            setTimeout(testEnvironment, 500);
        };
    </script>
</body>
</html>