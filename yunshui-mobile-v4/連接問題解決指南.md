# 手機應用連接問題解決指南

## 🔍 問題診斷

### 發現的問題
1. **API地址過期**: 手機應用使用舊地址 `192.168.68.95:3004`，但後端現在在 `192.168.68.103:3000`
2. **Metro連接問題**: 手機無法連接到Metro開發服務器
3. **網路配置變更**: IP地址從 `.95` 變更為 `.103`，端口從 `3004` 變更為 `3000`

### 已修復內容
- ✅ 更新手機應用API地址為 `http://192.168.68.103:3000/api`
- ✅ 創建修復腳本清理緩存
- ✅ 使用隧道模式解決Metro連接問題

## 🚀 立即解決方案

### 方法1: 使用修復腳本 (推薦)
```bash
cd yunshui-mobile-v4
fix-connection-and-start.bat
```

### 方法2: 手動步驟
1. **確認後端運行**:
   ```bash
   # 檢查後端是否在新地址運行
   curl http://192.168.68.103:3000/health
   ```

2. **清理緩存**:
   ```bash
   cd yunshui-mobile-v4
   rmdir /s /q .expo
   ```

3. **啟動應用**:
   ```bash
   npx expo start --tunnel --clear
   ```

## 📱 手機端操作

### 1. 重新掃描QR碼
- 關閉Expo Go應用
- 重新打開Expo Go
- 掃描新的QR碼

### 2. 如果仍有問題
- 確保手機和電腦在同一WiFi
- 重啟手機WiFi連接
- 嘗試使用隧道模式 (`--tunnel`)

## 🔧 技術細節

### API地址變更
```javascript
// 舊地址 (已失效)
const API_BASE_URL = 'http://192.168.68.95:3004/api';

// 新地址 (已修復)
const API_BASE_URL = 'http://192.168.68.103:3000/api';
```

### 測試端點
- 🔗 健康檢查: http://192.168.68.103:3000/health
- 🔗 登入API: http://192.168.68.103:3000/api/auth/login
- 🔗 訂單API: http://192.168.68.103:3000/api/orders

## 🎯 預期結果

### 修復後應該看到
- ✅ Expo開發服務器正常啟動
- ✅ 手機成功連接並載入應用
- ✅ 登入頁面正常顯示
- ✅ Jeffrey快速登入成功
- ✅ 可以看到8個訂單

### 測試步驟
1. 執行 `fix-connection-and-start.bat`
2. 掃描新的QR碼
3. 測試Jeffrey快速登入
4. 檢查是否能看到訂單

## 🆘 如果仍有問題

### 檢查清單
- [ ] 後端是否在 192.168.68.103:3000 運行？
- [ ] 手機和電腦是否在同一WiFi？
- [ ] Expo Go是否為最新版本？
- [ ] 是否清理了 .expo 緩存？

### 備用方案
1. **使用localhost模式**:
   ```bash
   npx expo start --localhost
   ```

2. **檢查防火牆設置**:
   - 確保Windows防火牆允許Node.js
   - 檢查路由器設置

3. **重新安裝依賴**:
   ```bash
   rmdir /s /q node_modules
   npm install
   ```

---

**修復時間**: 2024年10月30日  
**狀態**: API地址已更新，準備測試