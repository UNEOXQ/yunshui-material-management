# 環境配置指南\n\n本專案支援多環境配置，包括開發、測試和生產環境。每個環境都有獨立的配置檔案和最佳化設定。\n\n## 環境類型\n\n### 開發環境 (Development)\n- **用途**: 本地開發和除錯\n- **特點**: 詳細日誌、熱重載、除錯工具\n- **配置檔案**: `.env.development`\n\n### 測試環境 (Test)\n- **用途**: 自動化測試和 CI/CD\n- **特點**: 快速執行、最小資源使用\n- **配置檔案**: `.env.test`\n\n### 生產環境 (Production)\n- **用途**: 正式部署環境\n- **特點**: 高安全性、效能最佳化、完整監控\n- **配置檔案**: `.env.production`\n\n## 快速設定\n\n### 自動設定（推薦）\n\n使用互動式設定腳本：\n\n```bash\n# 設定所有環境\nnode scripts/setup-environment.js\n\n# 或使用 npm 腳本\ncd backend && npm run env:setup\n```\n\n### 手動設定\n\n1. 複製範例檔案：\n```bash\ncp .env.example .env\ncp backend/.env.development.example backend/.env.development\ncp frontend/.env.development.example frontend/.env.development\n```\n\n2. 編輯配置檔案，設定必要的值\n\n3. 驗證配置：\n```bash\ncd backend && npm run env:validate\n```\n\n## 環境變數說明\n\n### 後端環境變數\n\n#### 應用程式設定\n- `NODE_ENV`: 環境類型 (development/test/production)\n- `PORT`: 服務端口 (預設: 3001)\n\n#### 資料庫設定\n- `DB_HOST`: 資料庫主機位址\n- `DB_PORT`: 資料庫端口 (預設: 5432)\n- `DB_NAME`: 資料庫名稱\n- `DB_USER`: 資料庫使用者\n- `DB_PASSWORD`: 資料庫密碼\n- `DB_SSL`: 是否啟用 SSL (生產環境建議: true)\n- `DB_POOL_MIN`: 連線池最小連線數\n- `DB_POOL_MAX`: 連線池最大連線數\n\n#### Redis 設定\n- `REDIS_HOST`: Redis 主機位址\n- `REDIS_PORT`: Redis 端口 (預設: 6379)\n- `REDIS_PASSWORD`: Redis 密碼\n- `REDIS_DB`: Redis 資料庫編號\n\n#### JWT 設定\n- `JWT_SECRET`: JWT 簽名金鑰 (至少 32 字元)\n- `JWT_EXPIRES_IN`: JWT 過期時間 (如: 24h)\n- `JWT_REFRESH_SECRET`: 刷新 Token 金鑰\n- `JWT_REFRESH_EXPIRES_IN`: 刷新 Token 過期時間\n\n#### 檔案上傳設定\n- `UPLOAD_PATH`: 檔案上傳目錄\n- `MAX_FILE_SIZE`: 最大檔案大小 (位元組)\n- `ALLOWED_FILE_TYPES`: 允許的檔案類型 (逗號分隔)\n\n#### CORS 設定\n- `CORS_ORIGIN`: 允許的來源 (可用逗號分隔多個)\n- `CORS_CREDENTIALS`: 是否允許憑證\n\n#### 安全設定\n- `BCRYPT_ROUNDS`: 密碼雜湊輪數\n- `RATE_LIMIT_WINDOW_MS`: 速率限制時間窗口\n- `RATE_LIMIT_MAX_REQUESTS`: 速率限制最大請求數\n\n#### 日誌設定\n- `LOG_LEVEL`: 日誌等級 (debug/info/warn/error)\n- `LOG_FILE_PATH`: 日誌檔案路徑\n\n#### 監控設定\n- `HEALTH_CHECK_INTERVAL`: 健康檢查間隔\n- `METRICS_ENABLED`: 是否啟用指標收集\n\n### 前端環境變數\n\n#### API 設定\n- `VITE_API_URL`: 後端 API 基礎 URL\n- `VITE_WS_URL`: WebSocket 服務 URL\n\n#### 功能開關\n- `VITE_ENABLE_MOCK_DATA`: 是否啟用模擬資料\n- `VITE_ENABLE_DEBUG_MODE`: 是否啟用除錯模式\n- `VITE_ENABLE_ANALYTICS`: 是否啟用分析追蹤\n\n#### UI 設定\n- `VITE_DEFAULT_LANGUAGE`: 預設語言\n- `VITE_THEME`: 預設主題\n\n#### 檔案上傳設定\n- `VITE_MAX_FILE_SIZE`: 最大檔案大小\n- `VITE_ALLOWED_FILE_TYPES`: 允許的檔案類型\n\n#### 效能設定\n- `VITE_PAGINATION_SIZE`: 分頁大小\n- `VITE_DEBOUNCE_DELAY`: 防抖延遲\n- `VITE_CACHE_DURATION`: 快取持續時間\n\n#### 安全設定\n- `VITE_SESSION_TIMEOUT`: 會話超時時間\n- `VITE_AUTO_LOGOUT_WARNING`: 自動登出警告時間\n\n## 環境特定配置\n\n### 開發環境\n\n```bash\n# 啟動開發環境\nNODE_ENV=development npm run dev\n\n# 或使用 Docker\nmake dev\n```\n\n**特點**:\n- 詳細的除錯日誌\n- 熱重載支援\n- 較低的安全設定（快速開發）\n- 模擬資料支援\n\n### 測試環境\n\n```bash\n# 執行測試\nNODE_ENV=test npm test\n\n# 啟動測試資料庫\ndocker-compose -f docker-compose.test.yml up -d\n```\n\n**特點**:\n- 快速的密碼雜湊\n- 獨立的測試資料庫\n- 最小的日誌輸出\n- 較短的 Token 過期時間\n\n### 生產環境\n\n```bash\n# 啟動生產環境\nNODE_ENV=production npm start\n\n# 或使用 Docker\nmake prod\n```\n\n**特點**:\n- 高安全性設定\n- SSL 資料庫連線\n- 完整的監控和日誌\n- 效能最佳化\n\n## 安全最佳實踐\n\n### 1. 金鑰管理\n- 使用強隨機金鑰（至少 32 字元）\n- 定期輪換 JWT 金鑰\n- 不要在程式碼中硬編碼金鑰\n\n### 2. 密碼安全\n- 生產環境使用強密碼\n- 使用適當的 bcrypt 輪數（生產: 12+）\n- 定期更新資料庫密碼\n\n### 3. 網路安全\n- 生產環境啟用 SSL\n- 限制 CORS 來源\n- 使用適當的速率限制\n\n### 4. 資料保護\n- 加密敏感的環境變數\n- 使用 Docker secrets 或 Kubernetes secrets\n- 定期備份配置\n\n## 故障排除\n\n### 常見問題\n\n1. **環境變數未載入**\n   ```bash\n   # 檢查檔案是否存在\n   ls -la .env*\n   \n   # 驗證配置\n   npm run env:validate\n   ```\n\n2. **資料庫連線失敗**\n   ```bash\n   # 檢查資料庫狀態\n   docker-compose ps database\n   \n   # 測試連線\n   psql -h localhost -U postgres -d yun_shui_materials\n   ```\n\n3. **JWT 金鑰錯誤**\n   ```bash\n   # 生成新的金鑰\n   node -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\"\n   ```\n\n4. **檔案權限問題**\n   ```bash\n   # 修復上傳目錄權限\n   chmod 755 uploads/\n   chown -R $USER:$USER uploads/\n   ```\n\n### 驗證配置\n\n```bash\n# 後端配置驗證\ncd backend && npm run env:validate\n\n# 檢查服務健康狀態\ncurl http://localhost:3001/health\n\n# 查看配置摘要\nnode -e \"console.log(require('./src/config/environment').getConfigSummary())\"\n```\n\n## 部署注意事項\n\n### Docker 部署\n\n1. 確保 `.env` 檔案包含正確的生產配置\n2. 使用 Docker secrets 管理敏感資訊\n3. 設定適當的健康檢查\n\n### Kubernetes 部署\n\n1. 使用 ConfigMap 管理非敏感配置\n2. 使用 Secret 管理敏感資訊\n3. 設定適當的資源限制\n\n### 雲端部署\n\n1. 使用雲端提供商的金鑰管理服務\n2. 設定環境變數注入\n3. 啟用監控和日誌收集\n\n## 監控和維護\n\n### 配置監控\n\n- 監控環境變數變更\n- 追蹤配置錯誤\n- 設定配置驗證警報\n\n### 定期維護\n\n- 更新過期的金鑰\n- 檢查安全設定\n- 驗證備份配置\n- 更新依賴版本\n\n## 相關文件\n\n- [Docker 部署指南](DOCKER.md)\n- [資料庫設定](backend/DATABASE.md)\n- [API 文件](API.md)\n- [安全指南](SECURITY.md)"