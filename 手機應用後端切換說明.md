# 手機應用後端切換說明

## 🔍 問題分析

你遇到的問題是：
- **完整後端** (`npm run dev`) 使用PostgreSQL數據庫，但訂單API有500錯誤
- **簡化後端** (`node simple-server.js`) 使用內存數據庫，已修復並包含測試數據

## 🎯 解決方案

### 選項1: 使用簡化後端 (推薦)

**優點**:
- ✅ 已修復，包含3個測試訂單
- ✅ 無需數據庫配置
- ✅ 專為手機應用優化
- ✅ 立即可用

**啟動方式**:
```bash
# 方法1: 使用切換腳本
switch-to-simple-backend.bat

# 方法2: 手動啟動
cd backend
node simple-server.js
```

### 選項2: 修復完整後端

**需要做的事**:
1. 檢查PostgreSQL數據庫連接
2. 運行數據庫遷移
3. 初始化測試數據
4. 修復OrderModel的查詢問題

## 📱 測試數據 (簡化後端)

簡化後端包含以下測試訂單：

| 訂單ID | 類型 | 狀態 | 用戶 | 項目數 |
|--------|------|------|------|--------|
| order-1 | AUXILIARY | PENDING | PM | 2 |
| order-2 | FINISHED | APPROVED | ADMIN | 1 |
| id-1002 | AUXILIARY | PENDING | WAREHOUSE | 2 |

### 角色測試結果
- **Jeffrey (PM)**: 應該看到 2 個輔材訂單
- **Miya (AM)**: 應該看到 1 個完成材訂單
- **Mark (WAREHOUSE)**: 應該看到 3 個訂單
- **系統管理員**: 應該看到 3 個訂單

## 🚀 立即測試步驟

### 1. 切換到簡化後端
```bash
switch-to-simple-backend.bat
```

### 2. 重新載入手機應用
- 在Expo Go中搖動設備
- 選擇 "Reload"
- 或重新掃描QR碼

### 3. 測試訂單顯示
- 登入 Jeffrey
- 檢查儀表板「總訂單數」應該顯示 **2**
- 點擊「🔧 輔材訂單管理」
- 應該看到 2 個輔材訂單

## 🔧 API端點對比

### 簡化後端 (推薦)
```
✅ GET /api/orders - 返回所有訂單 (已修復)
✅ POST /api/orders/auxiliary - 創建輔材訂單
✅ POST /api/orders/finished - 創建完成材訂單
✅ GET /api/materials - 獲取材料列表
✅ POST /api/auth/login - 用戶登入
```

### 完整後端 (有問題)
```
❌ GET /api/orders - 500錯誤 (數據庫問題)
❓ 其他端點可能正常
```

## 💡 建議

**立即使用**: 執行 `switch-to-simple-backend.bat` 來測試手機應用

**長期方案**: 如果需要完整功能，可以後續修復完整後端的數據庫問題

---

**更新時間**: 2024年10月29日  
**狀態**: 簡化後端已準備就緒